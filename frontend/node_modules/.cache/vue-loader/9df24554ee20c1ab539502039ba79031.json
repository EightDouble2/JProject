{"remainingRequest":"/Users/johnnyhao/WorkSpace/IDEAProjects/JShop/frontend/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/johnnyhao/WorkSpace/IDEAProjects/JShop/frontend/src/views/profile/icon.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/johnnyhao/WorkSpace/IDEAProjects/JShop/frontend/src/views/profile/icon.vue","mtime":1579748797752},{"path":"/Users/johnnyhao/WorkSpace/IDEAProjects/JShop/frontend/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/johnnyhao/WorkSpace/IDEAProjects/JShop/frontend/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/johnnyhao/WorkSpace/IDEAProjects/JShop/frontend/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/johnnyhao/WorkSpace/IDEAProjects/JShop/frontend/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport ImageCropper from 'vue-image-crop-upload'\nimport PanThumb from '@/components/PanThumb'\nimport { getToken } from '../../utils/auth'\nimport { modifyIcon } from '@/api/profile'\n\nexport default {\n  name: 'ProfileIcon',\n  components: { ImageCropper, PanThumb },\n  data() {\n    return {\n      url: process.env.VUE_APP_BASE_API + '/upload',\n      show: false,\n      params: {\n        access_token: getToken()\n      },\n      headers: {\n        smail: '*_~'\n      },\n      image: this.$store.getters.avatar\n    }\n  },\n  methods: {\n    toggleShow() {\n      this.show = !this.show\n    },\n\n    /**\n     *\n     * @param image\n     * @param field\n     */\n    cropSuccess(image, field) {\n      console.log('-------- crop success --------')\n      this.image = image\n    },\n\n    /**\n     * 上传成功\n     * @param jsonData 服务器返回数据，已进行 JSON 转码\n     * @param field\n     */\n    cropUploadSuccess(jsonData, field) {\n      console.log('-------- upload success --------')\n      console.log(jsonData)\n      console.log('path: ', jsonData.data.path)\n      console.log('field: ' + field)\n\n      // 更新头像\n      modifyIcon({\n        username: this.$store.getters.name,\n        path: jsonData.data.path\n      }).then(response => {\n        this.$message({\n          message: response.message,\n          type: 'success'\n        })\n\n        // 更新 vuex 中的头像\n        this.$store.dispatch('user/setAvatar', jsonData.data.path)\n      }).catch(() => {\n      })\n    },\n\n    /**\n     * 上传失败\n     * @param status 服务器返回的失败状态码\n     * @param field\n     */\n    cropUploadFail(status, field) {\n      console.log('-------- upload fail --------')\n      console.log(status)\n      console.log('field: ' + field)\n    }\n  }\n}\n",null]}